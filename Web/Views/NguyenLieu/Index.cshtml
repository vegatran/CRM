@model IEnumerable<Domain.Entities.NguyenLieu>

@{
    ViewData["Title"] = "Quản lý Nguyên liệu";
}

<div class="card">
    <div class="card-header">
        <h3 class="card-title">Danh sách Nguyên liệu</h3>
        <div class="card-tools">
            <button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#createModal">
                <i class="fas fa-plus"></i> Thêm mới
            </button>
        </div>
    </div>
    <div class="card-body">
        <table id="nguyenLieuTable" class="table table-bordered table-striped">
            <thead>
                <tr>
                    <th>Hình ảnh</th>
                    <th>Mã NL</th>
                    <th>Tên nguyên liệu</th>
                    <th>Loại nguyên liệu</th>
                    <th>Nhà cung cấp</th>
                    <th>Giá nhập</th>
                    <th>Số lượng tồn</th>
                    <th>Đơn vị tính</th>
                    <th>Chất liệu</th>
                    <th>Màu sắc</th>
                    <th>Trạng thái</th>
                    <th>Thao tác</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td>
                            @if (!string.IsNullOrEmpty(item.HinhAnh))
                            {
                                <img src="@item.HinhAnh" alt="@item.TenNguyenLieu" class="img-thumbnail" style="width: 50px; height: 50px; object-fit: cover;" />
                            }
                            else
                            {
                                <div class="bg-light d-flex align-items-center justify-content-center" style="width: 50px; height: 50px;">
                                    <i class="fas fa-image text-muted"></i>
                                </div>
                            }
                        </td>
                        <td>@item.MaNguyenLieu</td>
                        <td>@item.TenNguyenLieu</td>
                        <td>@item.LoaiNguyenLieu?.TenLoai</td>
                        <td>@item.NhaCungCap?.TenNhaCungCap</td>
                        <td>@item.GiaNhap.ToString("N0") VNĐ</td>
                        <td>
                            <span class="badge @(item.SoLuongTon > 10 ? "badge-success" : item.SoLuongTon > 0 ? "badge-warning" : "badge-danger")">
                                @item.SoLuongTon
                            </span>
                        </td>
                        <td>@item.DonViTinh</td>
                        <td>@item.ChatLieu</td>
                        <td>
                            @if (!string.IsNullOrEmpty(item.MauSac))
                            {
                                @if (item.MauSac.StartsWith("#"))
                                {
                                    <div class="d-flex align-items-center">
                                        <div class="color-preview mr-2" style="width: 20px; height: 20px; background-color: @item.MauSac; border: 1px solid #ddd; border-radius: 3px;"></div>
                                        <span>@item.MauSac</span>
                                    </div>
                                }
                                else if (item.MauSac.Contains("checkered"))
                                {
                                    <div class="d-flex align-items-center">
                                        <div class="color-preview mr-2" style="width: 20px; height: 20px; background: repeating-conic-gradient(#000 0% 25%, transparent 0% 50%) 50% / 20% 20%; border: 1px solid #ddd; border-radius: 3px;"></div>
                                        <span>@item.MauSac</span>
                                    </div>
                                }
                                else if (item.MauSac.Contains("stripe"))
                                {
                                    <div class="d-flex align-items-center">
                                        <div class="color-preview mr-2" style="width: 20px; height: 20px; background: repeating-linear-gradient(45deg, #000, #000 2px, transparent 2px, transparent 4px); border: 1px solid #ddd; border-radius: 3px;"></div>
                                        <span>@item.MauSac</span>
                                    </div>
                                }
                                else
                                {
                                    <span>@item.MauSac</span>
                                }
                            }
                            else
                            {
                                <span class="text-muted">-</span>
                            }
                        </td>
                        <td>
                            @if (item.TrangThai)
                            {
                                <span class="badge badge-success">Hoạt động</span>
                            }
                            else
                            {
                                <span class="badge badge-danger">Ngừng hoạt động</span>
                            }
                        </td>
                        <td>
                            <button type="button" class="btn btn-warning btn-sm edit-btn" data-id="@item.Id">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button type="button" class="btn btn-danger btn-sm delete-btn" data-id="@item.Id">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<!-- Modal Containers -->
<div id="modalContainer"></div>

@section Scripts {
    <script src="~/js/nguyenlieu.js"></script>
} 