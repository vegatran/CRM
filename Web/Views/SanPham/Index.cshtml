@model IEnumerable<Domain.Entities.SanPham>

@{
    ViewData["Title"] = "Qu·∫£n l√Ω S·∫£n ph·∫©m";
}

<div class="card">
    <div class="card-header">
        <h3 class="card-title">Danh s√°ch S·∫£n ph·∫©m</h3>
        <div class="card-tools">
            <button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#createModal">
                <i class="fas fa-plus"></i> Th√™m m·ªõi
            </button>
        </div>
    </div>
    <div class="card-body">
        <table id="sanPhamTable" class="table table-bordered table-striped">
            <thead>
                <tr>
                    <th>H√¨nh ·∫£nh</th>
                    <th>M√£ SP</th>
                    <th>T√™n s·∫£n ph·∫©m</th>
                    <th>Lo·∫°i SP</th>
                    <th>Gi√° b√°n</th>
                    <th>Gi√° v·ªën</th>
                    <th>Chi ph√≠ s·∫£n xu·∫•t</th>
                    <th>L·ª£i nhu·∫≠n</th>
                    <th>S·ªë l∆∞·ª£ng t·ªìn</th>
                    <th>K√≠ch th∆∞·ªõc</th>
                    <th>M√†u s·∫Øc</th>
                    <th>Tr·∫°ng th√°i</th>
                    <th>Thao t√°c</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td>
                            @if (!string.IsNullOrEmpty(item.HinhAnh))
                            {
                                <img src="@item.HinhAnh" alt="@item.TenSanPham" class="img-thumbnail" style="width: 60px; height: 60px; object-fit: cover;" />
                            }
                            else
                            {
                                <div class="bg-light d-flex align-items-center justify-content-center" style="width: 60px; height: 60px;">
                                    <i class="fas fa-image text-muted"></i>
                                </div>
                            }
                        </td>
                        <td>@item.MaSanPham</td>
                        <td>@item.TenSanPham</td>
                        <td>
                            @if (item.LoaiSanPham == Domain.Entities.LoaiSanPham.TuSanXuat)
                            {
                                <span class="badge badge-info">
                                    <i class="fas fa-industry"></i> T·ª± s·∫£n xu·∫•t
                                </span>
                            }
                            else
                            {
                                <span class="badge badge-warning">
                                    <i class="fas fa-shopping-cart"></i> Mua ngo√†i
                                </span>
                            }
                        </td>
                        <td>@item.GiaBan.ToString("N0") VNƒê</td>
                        <td>
                            @if (item.LoaiSanPham == Domain.Entities.LoaiSanPham.TuSanXuat)
                            {
                                <span class="text-info font-weight-bold">
                                    @item.GiaVon.ToString("N0") VNƒê
                                    <small class="text-muted d-block">(T·ª± t√≠nh)</small>
                                </span>
                            }
                            else
                            {
                                <span class="text-warning font-weight-bold">
                                    @item.GiaVon.ToString("N0") VNƒê
                                    <small class="text-muted d-block">(Gi√° nh·∫≠p)</small>
                                </span>
                            }
                        </td>
                        <td>
                            @if (item.LoaiSanPham == Domain.Entities.LoaiSanPham.TuSanXuat)
                            {
                                <div>
                                    <div class="text-success">@item.TongChiPhiSanXuat.ToString("N0") VNƒê</div>
                                    <small class="text-muted">
                                        NL: @item.TongChiPhiNguyenLieu.ToString("N0") | 
                                        NC: @item.TongChiPhiNhanCong.ToString("N0")
                                    </small>
                                </div>
                            }
                            else
                            {
                                <span class="text-muted">-</span>
                            }
                        </td>
                        <td>
                            @{
                                var loiNhuan = item.GiaBan - item.GiaVon;
                                var phanTramLoiNhuan = item.PhanTramLoiNhuan;
                                var loiNhuanClass = loiNhuan >= 0 ? "text-success" : "text-danger";
                                var phanTramClass = phanTramLoiNhuan >= 0 ? "text-success" : "text-danger";
                            }
                            <div>
                                <div class="@loiNhuanClass font-weight-bold">
                                    @loiNhuan.ToString("N0") VNƒê
                                </div>
                                <small class="@phanTramClass">
                                    @phanTramLoiNhuan.ToString("F1")%
                                </small>
                            </div>
                        </td>
                        <td>
                            @if (item.SoLuongTon <= 10)
                            {
                                <span class="badge badge-danger">@item.SoLuongTon</span>
                            }
                            else if (item.SoLuongTon <= 50)
                            {
                                <span class="badge badge-warning">@item.SoLuongTon</span>
                            }
                            else
                            {
                                <span class="badge badge-success">@item.SoLuongTon</span>
                            }
                        </td>
                        <td>@item.KichThuoc</td>
                        <td>
                            @if (!string.IsNullOrEmpty(item.MauSac))
                            {
                                <div class="d-flex align-items-center">
                                    @if (item.MauSac.StartsWith("#"))
                                    {
                                        <div class="color-preview" style="width: 20px; height: 20px; background-color: @item.MauSac; border: 1px solid #ddd; border-radius: 3px; margin-right: 8px;"></div>
                                        <span>@item.MauSac</span>
                                    }
                                    else if (item.MauSac.Contains("Caro"))
                                    {
                                        <div class="color-preview checkered-pattern" style="width: 20px; height: 20px; border: 1px solid #ddd; border-radius: 3px; margin-right: 8px;" data-pattern="@item.MauSac"></div>
                                        <span>@item.MauSac</span>
                                    }
                                    else if (item.MauSac.Contains("S·ªçc"))
                                    {
                                        <div class="color-preview stripe-pattern" style="width: 20px; height: 20px; border: 1px solid #ddd; border-radius: 3px; margin-right: 8px;" data-pattern="@item.MauSac"></div>
                                        <span>@item.MauSac</span>
                                    }
                                    else
                                    {
                                        <div class="color-preview" style="width: 20px; height: 20px; background-color: #f0f0f0; border: 1px solid #ddd; border-radius: 3px; margin-right: 8px; display: flex; align-items: center; justify-content-center; font-size: 10px;">üé®</div>
                                        <span>@item.MauSac</span>
                                    }
                                </div>
                            }
                            else
                            {
                                <span class="text-muted">Ch∆∞a c√≥</span>
                            }
                        </td>
                        <td>
                            @if (item.TrangThai)
                            {
                                <span class="badge badge-success">Ho·∫°t ƒë·ªông</span>
                            }
                            else
                            {
                                <span class="badge badge-danger">Ng·ª´ng ho·∫°t ƒë·ªông</span>
                            }
                        </td>
                        <td>
                            @if (item.LoaiSanPham == Domain.Entities.LoaiSanPham.TuSanXuat)
                            {
                                <a href="@Url.Action("ChiTietSanXuat", new { id = item.Id })" class="btn btn-info btn-sm" title="Chi ti·∫øt s·∫£n xu·∫•t">
                                    <i class="fas fa-industry"></i>
                                </a>
                            }
                            <button type="button" class="btn btn-warning btn-sm edit-btn" data-id="@item.Id">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button type="button" class="btn btn-danger btn-sm delete-btn" data-id="@item.Id">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<!-- Modal Containers -->
<div id="modalContainer"></div>

@section Scripts {
    <script src="~/js/sanpham.js"></script>
} 