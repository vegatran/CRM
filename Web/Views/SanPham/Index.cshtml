@model IEnumerable<Domain.Entities.SanPham>

@{
    ViewData["Title"] = "Quản lý Sản phẩm";
}

<div class="card">
    <div class="card-header">
        <h3 class="card-title">Danh sách Sản phẩm</h3>
        <div class="card-tools">
            <button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#createModal">
                <i class="fas fa-plus"></i> Thêm mới
            </button>
        </div>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table id="sanPhamTable" class="table table-bordered table-striped">
            <thead>
                <tr>
                    <th>Hình ảnh</th>
                    <th>Mã SP</th>
                    <th>Tên sản phẩm</th>
                    <th>Loại SP</th>
                    <th>Giá bán</th>
                    <th>Giá vốn</th>
                    <th>Chi phí sản xuất</th>
                    <th>Lợi nhuận</th>
                    <th>Số lượng tồn</th>
                    <th>Kích thước</th>
                    <th>Màu sắc</th>
                    <th>Trạng thái</th>
                    <th>Thao tác</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td>
                            @if (!string.IsNullOrEmpty(item.HinhAnh))
                            {
                                <img src="@item.HinhAnh" alt="@item.TenSanPham" class="img-thumbnail" style="width: 60px; height: 60px; object-fit: cover;" />
                            }
                            else
                            {
                                <div class="bg-light d-flex align-items-center justify-content-center" style="width: 60px; height: 60px;">
                                    <i class="fas fa-image text-muted"></i>
                                </div>
                            }
                        </td>
                        <td>@item.MaSanPham</td>
                        <td>@item.TenSanPham</td>
                        <td>
                            @if (item.LoaiSanPham == Domain.Entities.LoaiSanPham.TuSanXuat)
                            {
                                <span class="badge badge-info">
                                    <i class="fas fa-industry"></i> Tự sản xuất
                                </span>
                            }
                            else
                            {
                                <span class="badge badge-warning">
                                    <i class="fas fa-shopping-cart"></i> Mua ngoài
                                </span>
                            }
                        </td>
                        <td>@item.GiaBan.ToString("N0") VNĐ</td>
                        <td>
                            @if (item.LoaiSanPham == Domain.Entities.LoaiSanPham.TuSanXuat)
                            {
                                <span class="text-info font-weight-bold">
                                    @item.GiaVon.ToString("N0") VNĐ
                                    <small class="text-muted d-block">(Tự tính)</small>
                                </span>
                            }
                            else
                            {
                                <span class="text-warning font-weight-bold">
                                    @item.GiaVon.ToString("N0") VNĐ
                                    <small class="text-muted d-block">(Giá nhập)</small>
                                </span>
                            }
                        </td>
                        <td>
                            @if (item.LoaiSanPham == Domain.Entities.LoaiSanPham.TuSanXuat)
                            {
                                <div>
                                    <div class="text-success">@item.TongChiPhiSanXuat.ToString("N0") VNĐ</div>
                                    <small class="text-muted">
                                        NL: @item.TongChiPhiNguyenLieu.ToString("N0") | 
                                        NC: @item.TongChiPhiNhanCong.ToString("N0")
                                    </small>
                                </div>
                            }
                            else
                            {
                                <span class="text-muted">-</span>
                            }
                        </td>
                        <td>
                            @{
                                var loiNhuan = item.GiaBan - item.GiaVon;
                                var phanTramLoiNhuan = item.PhanTramLoiNhuan;
                                var loiNhuanClass = loiNhuan >= 0 ? "text-success" : "text-danger";
                                var phanTramClass = phanTramLoiNhuan >= 0 ? "text-success" : "text-danger";
                            }
                            <div>
                                <div class="@loiNhuanClass font-weight-bold">
                                    @loiNhuan.ToString("N0") VNĐ
                                </div>
                                <small class="@phanTramClass">
                                    @phanTramLoiNhuan.ToString("F1")%
                                </small>
                            </div>
                        </td>
                        <td>
                            @if (item.SoLuongTon <= 10)
                            {
                                <span class="badge badge-danger">@item.SoLuongTon</span>
                            }
                            else if (item.SoLuongTon <= 50)
                            {
                                <span class="badge badge-warning">@item.SoLuongTon</span>
                            }
                            else
                            {
                                <span class="badge badge-success">@item.SoLuongTon</span>
                            }
                        </td>
                        <td>@item.KichThuoc</td>
                        <td>
                            @if (!string.IsNullOrEmpty(item.MauSac))
                            {
                                <div class="d-flex align-items-center">
                                    @if (item.MauSac.StartsWith("#"))
                                    {
                                        <!-- Màu hex -->
                                        <div class="color-preview" style="width: 20px; height: 20px; background-color: @item.MauSac; border: 1px solid #ddd; border-radius: 3px; margin-right: 8px;"></div>
                                        <span>@item.MauSac</span>
                                    }
                                    else if (item.MauSac.Contains("Caro đỏ trắng"))
                                    {
                                        <!-- Pattern caro đỏ trắng -->
                                        <div class="color-preview checkered-pattern" style="width: 20px; height: 20px; border: 1px solid #ddd; border-radius: 3px; margin-right: 8px; background-image: linear-gradient(45deg, #ff0000 25%, transparent 25%), linear-gradient(-45deg, #ff0000 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #ff0000 75%), linear-gradient(-45deg, transparent 75%, #ff0000 75%); background-size: 8px 8px; background-position: 0 0, 0 4px, 4px -4px, -4px 0px;"></div>
                                        <span>@item.MauSac</span>
                                    }
                                    else if (item.MauSac.Contains("Caro xanh trắng"))
                                    {
                                        <!-- Pattern caro xanh trắng -->
                                        <div class="color-preview checkered-pattern" style="width: 20px; height: 20px; border: 1px solid #ddd; border-radius: 3px; margin-right: 8px; background-image: linear-gradient(45deg, #0000ff 25%, transparent 25%), linear-gradient(-45deg, #0000ff 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #0000ff 75%), linear-gradient(-45deg, transparent 75%, #0000ff 75%); background-size: 8px 8px; background-position: 0 0, 0 4px, 4px -4px, -4px 0px;"></div>
                                        <span>@item.MauSac</span>
                                    }
                                    else if (item.MauSac.Contains("Caro đen trắng"))
                                    {
                                        <!-- Pattern caro đen trắng -->
                                        <div class="color-preview checkered-pattern" style="width: 20px; height: 20px; border: 1px solid #ddd; border-radius: 3px; margin-right: 8px; background-image: linear-gradient(45deg, #000000 25%, transparent 25%), linear-gradient(-45deg, #000000 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #000000 75%), linear-gradient(-45deg, transparent 75%, #000000 75%); background-size: 8px 8px; background-position: 0 0, 0 4px, 4px -4px, -4px 0px;"></div>
                                        <span>@item.MauSac</span>
                                    }
                                    else if (item.MauSac.Contains("Caro xanh đỏ"))
                                    {
                                        <!-- Pattern caro xanh đỏ -->
                                        <div class="color-preview checkered-pattern" style="width: 20px; height: 20px; border: 1px solid #ddd; border-radius: 3px; margin-right: 8px; background-image: linear-gradient(45deg, #0000ff 25%, transparent 25%), linear-gradient(-45deg, #0000ff 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #ff0000 75%), linear-gradient(-45deg, transparent 75%, #ff0000 75%); background-size: 8px 8px; background-position: 0 0, 0 4px, 4px -4px, -4px 0px;"></div>
                                        <span>@item.MauSac</span>
                                    }
                                    else if (item.MauSac.Contains("Sọc đỏ trắng"))
                                    {
                                        <!-- Pattern sọc đỏ trắng -->
                                        <div class="color-preview stripe-pattern" style="width: 20px; height: 20px; border: 1px solid #ddd; border-radius: 3px; margin-right: 8px; background-image: repeating-linear-gradient(45deg, #ff0000, #ff0000 2px, #ffffff 2px, #ffffff 4px);"></div>
                                        <span>@item.MauSac</span>
                                    }
                                    else if (item.MauSac.Contains("Sọc xanh trắng"))
                                    {
                                        <!-- Pattern sọc xanh trắng -->
                                        <div class="color-preview stripe-pattern" style="width: 20px; height: 20px; border: 1px solid #ddd; border-radius: 3px; margin-right: 8px; background-image: repeating-linear-gradient(45deg, #0000ff, #0000ff 2px, #ffffff 2px, #ffffff 4px);"></div>
                                        <span>@item.MauSac</span>
                                    }
                                    else if (item.MauSac.Contains("Sọc đen trắng"))
                                    {
                                        <!-- Pattern sọc đen trắng -->
                                        <div class="color-preview stripe-pattern" style="width: 20px; height: 20px; border: 1px solid #ddd; border-radius: 3px; margin-right: 8px; background-image: repeating-linear-gradient(45deg, #000000, #000000 2px, #ffffff 2px, #ffffff 4px);"></div>
                                        <span>@item.MauSac</span>
                                    }
                                    else if (item.MauSac.Contains("Đỏ"))
                                    {
                                        <!-- Màu đỏ -->
                                        <div class="color-preview" style="width: 20px; height: 20px; background-color: #FF0000; border: 1px solid #ddd; border-radius: 3px; margin-right: 8px;"></div>
                                        <span>@item.MauSac</span>
                                    }
                                    else if (item.MauSac.Contains("Xanh dương"))
                                    {
                                        <!-- Màu xanh dương -->
                                        <div class="color-preview" style="width: 20px; height: 20px; background-color: #0000FF; border: 1px solid #ddd; border-radius: 3px; margin-right: 8px;"></div>
                                        <span>@item.MauSac</span>
                                    }
                                    else if (item.MauSac.Contains("Xanh lá"))
                                    {
                                        <!-- Màu xanh lá -->
                                        <div class="color-preview" style="width: 20px; height: 20px; background-color: #00FF00; border: 1px solid #ddd; border-radius: 3px; margin-right: 8px;"></div>
                                        <span>@item.MauSac</span>
                                    }
                                    else if (item.MauSac.Contains("Vàng"))
                                    {
                                        <!-- Màu vàng -->
                                        <div class="color-preview" style="width: 20px; height: 20px; background-color: #FFFF00; border: 1px solid #ddd; border-radius: 3px; margin-right: 8px;"></div>
                                        <span>@item.MauSac</span>
                                    }
                                    else if (item.MauSac.Contains("Hồng"))
                                    {
                                        <!-- Màu hồng -->
                                        <div class="color-preview" style="width: 20px; height: 20px; background-color: #FF00FF; border: 1px solid #ddd; border-radius: 3px; margin-right: 8px;"></div>
                                        <span>@item.MauSac</span>
                                    }
                                    else if (item.MauSac.Contains("Đen"))
                                    {
                                        <!-- Màu đen -->
                                        <div class="color-preview" style="width: 20px; height: 20px; background-color: #000000; border: 1px solid #ddd; border-radius: 3px; margin-right: 8px;"></div>
                                        <span>@item.MauSac</span>
                                    }
                                    else if (item.MauSac.Contains("Trắng"))
                                    {
                                        <!-- Màu trắng -->
                                        <div class="color-preview" style="width: 20px; height: 20px; background-color: #FFFFFF; border: 1px solid #ddd; border-radius: 3px; margin-right: 8px;"></div>
                                        <span>@item.MauSac</span>
                                    }
                                    else if (item.MauSac.Contains("Nhiều màu") || item.MauSac.Contains("Hoa văn"))
                                    {
                                        <!-- Pattern nhiều màu hoặc hoa văn -->
                                        <div class="color-preview" style="width: 20px; height: 20px; background: linear-gradient(45deg, #ff0000, #00ff00, #0000ff, #ffff00, #ff00ff); border: 1px solid #ddd; border-radius: 3px; margin-right: 8px;"></div>
                                        <span>@item.MauSac</span>
                                    }
                                    else
                                    {
                                        <!-- Pattern khác -->
                                        <div class="color-preview" style="width: 20px; height: 20px; background-color: #f0f0f0; border: 1px solid #ddd; border-radius: 3px; margin-right: 8px; display: flex; align-items: center; justify-content-center; font-size: 10px;">🎨</div>
                                        <span>@item.MauSac</span>
                                    }
                                </div>
                            }
                            else
                            {
                                <span class="text-muted">Chưa có</span>
                            }
                        </td>
                        <td>
                            @if (item.TrangThai)
                            {
                                <span class="badge badge-success">Hoạt động</span>
                            }
                            else
                            {
                                <span class="badge badge-danger">Ngừng hoạt động</span>
                            }
                        </td>
                        <td>
                            @if (item.LoaiSanPham == Domain.Entities.LoaiSanPham.TuSanXuat)
                            {
                                <a href="@Url.Action("ChiTietSanXuat", new { id = item.Id })" class="btn btn-info btn-sm" title="Chi tiết sản xuất">
                                    <i class="fas fa-industry"></i>
                                </a>
                            }
                            <button type="button" class="btn btn-warning btn-sm edit-btn" data-id="@item.Id">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button type="button" class="btn btn-danger btn-sm delete-btn" data-id="@item.Id">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
        </div>
    </div>
</div>

<!-- Modal Containers -->
<div id="modalContainer"></div>

@section Scripts {
    <script src="~/js/sanpham.js"></script>
} 